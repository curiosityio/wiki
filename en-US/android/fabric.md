---
name: Fabric
---

# Install

* Add to `app/build.gradle`:

```
buildscript {
    repositories {
        maven { url 'https://maven.fabric.io/public' }
        mavenCentral()
    }

    dependencies {
        classpath 'io.fabric.tools:gradle:1.+'
    }
}
apply plugin: 'com.android.application'
apply plugin: 'io.fabric'

...

repositories {
    maven { url 'http://s3.amazonaws.com/fabric-artifacts/public' } // <--- this works better for proxies instead of this --> maven { url 'https://maven.fabric.io/public' }
    mavenCentral()
}

android {
    ...
}

dependencies {
    ...
    compile('com.crashlytics.sdk.android:crashlytics:2.6.5@aar') {
        transitive = true;
    }
}

```

* Add to your manifest:

```
<?xml version="1.0" encoding="utf-8"?>
<manifest xmlns:android="http://schemas.android.com/apk/res/android"
          package="com.levibostian.foo">

    <uses-permission android:name="android.permission.INTERNET" />

    <application
        android:name="com.levibostian.foo.MainApplication"
        android:allowBackup="true"
        android:icon="@mipmap/ic_launcher"
        android:label="@string/app_name"
        android:theme="@style/AppTheme">
        <activity android:name=".MainActivity">
            <intent-filter>
                <action android:name="android.intent.action.MAIN" />
                <category android:name="android.intent.category.LAUNCHER" />
            </intent-filter>
        </activity>                
    </application>

</manifest>

```

* Add to your Application file:

```
class MainApplication : Application() {

    override fun onCreate() {
        super.onCreate()

        val core = CrashlyticsCore.Builder().disabled(BuildConfig.DEBUG).build()
        val fabric = Fabric.Builder(this).kits(Crashlytics.Builder().core(core).build()).debuggable(true).build()
        Fabric.with(fabric)
    }
}
```

* Create `app/fabric.properties`, and add following:

```
#Contains API Secret used to validate your application. Commit to internal source control; avoid making secret public.
#Mon Jan 16 18:43:59 CST 2017
apiSecret=apiSecretHere
apiKey=apiKeyHere
```

The fabric Android Studio plugin can generate these for you or you can get them from Fabric.io I believe.

# Util for logging errors and sending up to Crashlytics

```
fun error(e: Throwable) {
    if (BuildConfig.DEBUG) {
        e.printStackTrace()
    } else {
        Crashlytics.getInstance().core.logException(e)
    }
}
```

Could make this a Kotlin extension for Log too.

# Install fabric to Android app and keep api key and secret private

If you have an open source project, like [AndroidBlanky](https://github.com/curiosityio/androidblanky) you want to keep the Fabric api key and secret private and not check it into source control.

First, follow the build above on installing Fabric to an Android app. This allows only having to create 1 separate/single file that contains the secret and key.

Then, do the following to get your builds to succeed on your machine and on a CI server.

* Add one line to your `.gitignore`file:

```
app/fabric.properties
```

* Create (if you have not already) a file `app/fabric.properties` on your local machine so you can use that for local dev.

* Add the following to your `app/build.gradle` file. Really, anywhere you want. Make sure it's on it's own line though. I like to put it right above the dependencies array.

```
// Code found from https://github.com/plastiv/CrashlyticsDemo used to build app on CI.
afterEvaluate {
    initFabricPropertiesIfNeeded()
}

def initFabricPropertiesIfNeeded() {
    def propertiesFile = file('fabric.properties')
    if (!propertiesFile.exists()) {
        def commentMessage = "This is autogenerated fabric property from system environment to prevent key to be committed to source control."
        ant.propertyfile(file: "fabric.properties", comment: commentMessage) {
            entry(key: "apiSecret", value: crashlyticsdemoApisecret)
            entry(key: "apiKey", value: crashlyticsdemoApikey)
        }
    }
}
```

* Configure your CI server with 2 environment variables:

```
ORG_GRADLE_PROJECT_crashlyticsdemoApikey=keyhere
ORG_GRADLE_PROJECT_crashlyticsdemoApisecret=secretHere
```

Done. 
